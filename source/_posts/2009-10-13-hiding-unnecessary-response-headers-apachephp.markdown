--- 
layout: post
title: Hiding Unnecessary Response Headers Apache/PHP
wordpress_id: 164
wordpress_url: http://www.aknosis.com/?p=164
date: 2009-10-13 23:23:15 -07:00
comments: true
---
One way to help protect your website/server is to not tell everyone what platform and app versions everything is running on. If you were to request a php file from my site you see some response headers that could be useful to people looking to break in, cause havoc etc...

Here is my request to aknosis.com (I'm viewing all of this in <a href="http://getfirebug.com/">Firebug</a>, if you don't have it get it, best web development tool in my arsenal)
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td>Date</td>
<td><code>Wed, 14 Oct 2009 05:59:59 GMT</code></td>
</tr>
<tr>
<td>Server</td>
<td><code>Apache/2.2.3 (CentOS) PHP/5.2.9 mod_ssl/2.2.3 OpenSSL/0.9.8b</code></td>
</tr>
<tr>
<td>X-Powered-By</td>
<td><code>PHP/5.2.9</code></td>
</tr>
<tr>
<td>X-Pingback</td>
<td><code>http://www.aknosis.com/akwp/xmlrpc.php</code></td>
</tr>
<tr>
<td>Expires</td>
<td><code>Wed, 11 Jan 1984 05:00:00 GMT</code></td>
</tr>
<tr>
<td>Last-Modified</td>
<td><code>Wed, 14 Oct 2009 06:00:00 GMT</code></td>
</tr>
<tr>
<td>Cache-Control</td>
<td><code>no-cache, must-revalidate, max-age=0</code></td>
</tr>
<tr>
<td>Pragma</td>
<td><code>no-cache</code></td>
</tr>
<tr>
<td>Vary</td>
<td><code>Accept-Encoding,User-Agent</code></td>
</tr>
<tr>
<td>Content-Encoding</td>
<td><code>gzip</code></td>
</tr>
<tr>
<td>Content-Length</td>
<td><code>10636</code></td>
</tr>
<tr>
<td>Keep-Alive</td>
<td><code>timeout=2, max=100</code></td>
</tr>
<tr>
<td>Connection</td>
<td><code>Keep-Alive</code></td>
</tr>
<tr>
<td>Content-Type</td>
<td><code>text/html; charset=UTF-8</code></td>
</tr>
</tbody></table>
So if I was running a known insecure version of php, apache, or any other out of date software exposed in the response headers, an attacker has to look no further to determine what you are using and how best to attack you.
<h1>Apache</h1>
<!--more-->
First place to look is your httpd.conf, these are settings you want:
<h2><a href="http://httpd.apache.org/docs/2.2/mod/core.html#servertokens">ServerTokens Directive</a></h2>
<pre>ServerTokens Prod</pre>
Tells Apache to just output the product only, version information as well as modules are hidden. After changing this directive the Server response header is:
<pre>Server: Apache</pre>
<h2><a href="http://httpd.apache.org/docs/2.2/mod/core.html#serversignature">ServerSignature Directive</a></h2>
<pre>ServerSignature Off
</pre>
Any pages generated by Apache contain a small signature at the bottom with server information, setting this to off will suppress that additional info that no one needs.
<h1>PHP</h1>
Now to get rid of that pesky X-Powered-By header added by php, this is done in your php.ini file.
<pre>; Misc
;
; Decides whether PHP may expose the fact that it is installed
; on the server (e.g. by adding its signature to the Web
; server header). <strong>It is no security threat in any way</strong>, but it
; makes it possible to determine whether you use PHP on your
; server or not.
expose_php = On
</pre>
I think telling everyone what language you are using and the version is just a bad idea, yes you can figure this out by other methods (like what software is running... Wordpress anyone? heh) but I see no good reason to leave this on. What's worse is that it is ON by default (at least in my CentOS RPM). So turn that bad boy off.
<pre>expose_php = Off
</pre>
Don't forget to reboot! (Let be nice to any current surfers a la `service httpd graceful`)

Now a response from aknosis.com is much cleaner and 'safer':
<table class="netInfoHeadersText netInfoText netInfoHeadersTable " border="0" cellspacing="0" cellpadding="0">
<tbody class=" ">
<tr class=" ">
<td class="netInfoParamName ">Date</td>
<td class="netInfoParamValue "><code class=" ">Wed, 14 Oct 2009 06:04:21 GMT</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Server</td>
<td class="netInfoParamValue "><code class=" ">Apache</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">X-Pingback</td>
<td class="netInfoParamValue "><code class=" ">http://www.aknosis.com/akwp/xmlrpc.php</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Expires</td>
<td class="netInfoParamValue "><code class=" ">Wed, 11 Jan 1984 05:00:00 GMT</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Last-Modified</td>
<td class="netInfoParamValue "><code class=" ">Wed, 14 Oct 2009 06:04:21 GMT</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Cache-Control</td>
<td class="netInfoParamValue "><code class=" ">no-cache, must-revalidate, max-age=0</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Pragma</td>
<td class="netInfoParamValue "><code class=" ">no-cache</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Vary</td>
<td class="netInfoParamValue "><code class=" ">Accept-Encoding,User-Agent</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Content-Encoding</td>
<td class="netInfoParamValue "><code class=" ">gzip</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Content-Length</td>
<td class="netInfoParamValue "><code class=" ">10636</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Keep-Alive</td>
<td class="netInfoParamValue "><code class=" ">timeout=2, max=100</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Connection</td>
<td class="netInfoParamValue "><code class=" ">Keep-Alive</code></td>
</tr>
<tr class=" ">
<td class="netInfoParamName ">Content-Type</td>
<td class="netInfoParamValue "><code class=" ">text/html; charset=UTF-8</code></td>
</tr>
</tbody></table>
<div id="_mcePaste" style="overflow: hidden; position: absolute; left: -10000px; top: 717px; width: 1px; height: 1px;">service httpd graceful</div>
So there you have it, two simple file edits and a server reboot and you are one step ahead in the battle for a secure web environment.

Don't have access to httpd.conf? You can't change the ServerTokens value in .htaccess but you can change the ServerSignature in .htaccess.
Don't have access to php.ini? This is only settable inside php.ini :(

However, I do think it is perfectly valid to submit a request to change these if you are using a paid webhost, so go right ahead and do so!
